<!DOCTYPE html>
<html>

<head>
    <title>Interactive PSI Visualization</title>
    <!-- Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom CSS */
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }

        h2 {
            color: #343a40;
            margin-bottom: 20px;
            text-align: center;
        }

        h4 {
            color: #6c757d;
            font-weight: normal;
            margin-bottom: 20px;
            text-align: center;
        }

        .refresh-btn {
            margin-bottom: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .table-container {
            margin-top: 30px;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .table {
            margin-bottom: 0;
        }

        .table th,
        .table td {
            text-align: center;
            padding: 0.75rem;
            vertical-align: middle;
        }

        .table thead th {
            background-color: #e9ecef;
            border-bottom: 2px solid #dee2e6;
        }

        .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .psi-low {
            background-color: #d4edda;
        }

        .psi-moderate {
            background-color: #fff3cd;
        }

        .psi-high {
            background-color: #f8d7da;
        }

        .table tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.075);
            cursor: pointer;
        }

        .refresh-btn:hover {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        /* Footer styles */
        .footer {
            text-align: center; /* Center the footer text */
            margin-top: 30px; /* Add some space above the footer */
            font-size: 16px; /* Adjust font size */
            color: #6c757d; /* Muted color for footer */
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>Singapore PSI Visualization</h2>
        <h4 id="timestring">Last Updated: Loading...</h4>
        <button class="btn btn-primary refresh-btn" onclick="fetchPSIData()">Refresh Data</button>
        
        <div class="table-container">
            <table class="table table-striped" id="PSItable">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Central</th>
                        <th>West</th>
                        <th>East</th>
                        <th>North</th>
                        <th>South</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated here by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Footer with name and student ID -->
        <div class="footer">
            <p>Baorong Li - 1009456</p> 
        </div>
    </div>

    <!-- D3.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"
        integrity="sha512-vc58qvvBdrDR4etbxMdlTt4GBQk1qjvyORR2nrsPsFPyrs+/u5c3+1Ct6upOgdZoIl7eq6k3a1UPDSNAQi/32A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        // Function to fetch and display PSI data
        async function fetchPSIData() {
            try {
                const response = await fetch('https://api.data.gov.sg/v1/environment/psi');
                const data = await response.json();

                const timestamp = data.items[0].update_timestamp;
                const readings = data.items[0].readings;

                // Format the timestamp
                const formattedTimestamp = new Date(timestamp).toLocaleString();
                d3.select("#timestring").text(`Last Updated: ${formattedTimestamp}`);

                // Clear existing table rows
                const tableBody = d3.select("#PSItable tbody");
                tableBody.html("");

                // Loop through each reading and add rows to the table
                Object.entries(readings).forEach(([metric, regions]) => {
                    const row = tableBody.append("tr");
                    row.append("td").text(metric);

                    ["central", "west", "east", "north", "south"].forEach(region => {
                        const value = regions[region];
                        const cell = row.append("td").text(value);

                        // Add color coding based on PSI value
                        if (metric === "psi_twenty_four_hourly") {
                            if (value >= 100) cell.classed("psi-high", true);
                            else if (value >= 50) cell.classed("psi-moderate", true);
                            else cell.classed("psi-low", true);
                        }
                    });
                });
            } catch (error) {
                console.error("Error fetching PSI data:", error);
                d3.select("#timestring").text("Failed to fetch data. Please try again.");
            }
        }

        // Fetch data on page load
        fetchPSIData();
    </script>
</body>

</html>

